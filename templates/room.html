<!DOCTYPE html>
<html>
<head>
  <title>Room {{ code }}</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <h1>Room Code: {{ code }}</h1>

  <div id="joinSection">
    <input id="name" placeholder="Your Name">
    <button id="join" onclick="join()">Join Room</button>
  </div>

  <div id="lobbySection" style="display:none;">
    <h3>Players</h3>
    <ul id="players"></ul>
    <button id="startBtn" onclick="startGame()" style="display:none;">
      Start Game
    </button>
  </div>

  <div id="gameSection" style="display:none;">
    <!-- Game content will go here -->
  </div>

  <script>
    const socket = io();
    const code = "{{ code }}";
    let isHost = false;

    //////functions//////

    function join() {
      const name = document.getElementById("name").value.trim();
      if (!name) return;

      document.getElementById("name").disabled = true;
      document.getElementById("join").disabled = true;

      socket.emit("join_room", { code, name });
    }

    function startGame() {
      socket.emit("start_game", { code });
    }

    function createScoreCards(){
      socket.emit("create_scorecards", { code });
    }

    //////socket event handlers//////

    socket.on("joined", (data) => {
      localStorage.setItem("player_id", data.player_id);
      isHost = data.is_host;

      document.getElementById("joinSection").style.display = "none";
      document.getElementById("lobbySection").style.display = "block";

      if (isHost) {
        document.getElementById("startBtn").style.display = "inline-block";
      }
    });

    socket.on("player_list", (players) => {
      const list = document.getElementById("players");
      list.innerHTML = "";
      players.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        list.appendChild(li);
      });
    });

    socket.on("game_started", () => {
      document.getElementById("lobbySection").innerHTML = "";
      createScoreCards();
    });

    socket.on("scorecards_created", (scorecards) => {
      const div = document.getElementById("gameSection");
      div.style.display = "block";
      div.innerHTML = "";

      Object.values(scorecards).forEach(card => {
        const tableDiv = document.createElement("div");
        tableDiv.innerHTML = `<h3>Scorecard for ${card.Name}</h3>`;

        const table = document.createElement("table");
        table.innerHTML = `
          <tr>
            <th>Category</th>
            <th>Score</th>
          </tr>
          <tr><td>Aces</td><td>${card.Ones}</td></tr>
          <tr><td>Twos</td><td>${card.Twos}</td></tr>
          <tr><td>Threes</td><td>${card.Threes}</td></tr>
          <tr><td>Fours</td><td>${card.Fours}</td></tr>
          <tr><td>Fives</td><td>${card.Fives}</td></tr>
          <tr><td>Sixes</td><td>${card.Sixes}</td></tr>
          <tr><td>3 of a Kind</td><td>${card.ToK}</td></tr>
          <tr><td>4 of a Kind</td><td>${card.FoK}</td></tr>
          <tr><td>Full House</td><td>${card.FH}</td></tr>
          <tr><td>Sm Straight</td><td>${card.SmS}</td></tr>
          <tr><td>Lg Straight</td><td>${card.LgS}</td></tr>
          <tr><td>YAHTZEE</td><td>${card.Yahtzee}</td></tr>
          <tr><td>Chance</td><td>${card.Chance}</td></tr>
        `;

        tableDiv.appendChild(table);
        div.appendChild(tableDiv);
      });
    });

    

    socket.on("error", alert);
  </script>
</body>
</html>
